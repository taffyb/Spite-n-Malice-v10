import { Injector } from '@angular/core';
import { AngularPageVisibilityService } from './angular-page-visibility.service';
const providers = [
    { provide: AngularPageVisibilityService, deps: [] },
];
const injector = Injector.create({ providers: providers });
const pageVisibilityService = injector.get(AngularPageVisibilityService);
export function OnPageVisibilityChange() {
    return function (target, propertyKey, descriptor) {
        const originalMethod = descriptor.value;
        let onPageHiddenSubscription;
        if (!target.ngOnInit) {
            buildNewMethodNgOnInit(target);
        }
        const originalNgOnInit = target.ngOnInit;
        target.ngOnInit = function (...args) {
            onPageHiddenSubscription = pageVisibilityService.$onPageVisibilityChange.subscribe((visibilityState) => originalMethod.call(this, [visibilityState]));
            if (originalNgOnInit) {
                originalNgOnInit.call(this, args);
            }
        };
        if (!target.ngOnDestroy) {
            buildNewMethodNgOnDestroy(target);
        }
        const originalNgOnDestroy = target.ngOnDestroy;
        target.ngOnDestroy = function (...args) {
            onPageHiddenSubscription.unsubscribe();
            if (originalNgOnDestroy) {
                originalNgOnDestroy.call(this, args);
            }
        };
    };
}
export function OnPageHidden() {
    return function (target, propertyKey, descriptor) {
        const originalMethod = descriptor.value;
        let onPageHiddenSubscription;
        if (!target.ngOnInit) {
            buildNewMethodNgOnInit(target);
        }
        const originalNgOnInit = target.ngOnInit;
        target.ngOnInit = function (...args) {
            onPageHiddenSubscription = pageVisibilityService.$onPageHidden.subscribe(() => originalMethod.call(this));
            if (originalNgOnInit) {
                originalNgOnInit.call(this, args);
            }
        };
        if (!target.ngOnDestroy) {
            buildNewMethodNgOnDestroy(target);
        }
        const originalNgOnDestroy = target.ngOnDestroy;
        target.ngOnDestroy = function (...args) {
            onPageHiddenSubscription.unsubscribe();
            if (originalNgOnDestroy) {
                originalNgOnDestroy.call(this, args);
            }
        };
    };
}
export function OnPageVisible() {
    return function (target, propertyKey, descriptor) {
        const originalMethod = descriptor.value;
        if (!target.ngOnInit) {
            buildNewMethodNgOnInit(target);
        }
        const originalNgOnInit = target.ngOnInit;
        let onPageVisibleSubscription;
        target.ngOnInit = function (...args) {
            onPageVisibleSubscription = pageVisibilityService.$onPageVisible.subscribe(() => originalMethod.call(this));
            if (originalNgOnInit) {
                originalNgOnInit.call(this, args);
            }
        };
        if (!target.ngOnDestroy) {
            buildNewMethodNgOnDestroy(target);
        }
        const originalNgOnDestroy = target.ngOnDestroy;
        target.ngOnDestroy = function (...args) {
            onPageVisibleSubscription.unsubscribe();
            if (originalNgOnDestroy) {
                originalNgOnDestroy.call(this, args);
            }
        };
    };
}
export function OnPagePrerender() {
    return function (target, propertyKey, descriptor) {
        const originalMethod = descriptor.value;
        let onPagePrerenderSubscription;
        if (!target.ngOnInit) {
            buildNewMethodNgOnInit(target);
        }
        const originalNgOnInit = target.ngOnInit;
        target.ngOnInit = function (...args) {
            onPagePrerenderSubscription = pageVisibilityService.$onPagePrerender.subscribe(() => originalMethod.call(this));
            if (originalNgOnInit) {
                originalNgOnInit.call(this, args);
            }
        };
        if (!target.ngOnDestroy) {
            buildNewMethodNgOnDestroy(target);
        }
        const originalNgOnDestroy = target.ngOnDestroy;
        target.ngOnDestroy = function (...args) {
            onPagePrerenderSubscription.unsubscribe();
            if (originalNgOnDestroy) {
                originalNgOnDestroy.call(this, args);
            }
        };
    };
}
export function OnPageUnloaded() {
    return function (target, propertyKey, descriptor) {
        const originalMethod = descriptor.value;
        let onPageUnloadedSubscription;
        if (!target.ngOnInit) {
            buildNewMethodNgOnInit(target);
        }
        const originalNgOnInit = target.ngOnInit;
        target.ngOnInit = function (...args) {
            onPageUnloadedSubscription = pageVisibilityService.$onPageUnloaded.subscribe(() => originalMethod.call(this));
            if (originalNgOnInit) {
                originalNgOnInit.call(this, args);
            }
        };
        if (!target.ngOnDestroy) {
            buildNewMethodNgOnDestroy(target);
        }
        const originalNgOnDestroy = target.ngOnDestroy;
        target.ngOnDestroy = function (...args) {
            onPageUnloadedSubscription.unsubscribe();
            if (originalNgOnDestroy) {
                originalNgOnDestroy.call(this, args);
            }
        };
    };
}
function buildNewMethodNgOnInit(target) {
    newMethod(target, 'ngOnInit');
}
function buildNewMethodNgOnDestroy(target) {
    newMethod(target, 'ngOnDestroy');
}
function newMethod(target, name) {
    Object.defineProperty(target, name, {
        value: function (...args) { },
        writable: true,
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1wYWdlLXZpc2liaWxpdHkuZGVjb3JhdG9ycy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItcGFnZS12aXNpYmlsaXR5LyIsInNvdXJjZXMiOlsibGliL2FuZ3VsYXItcGFnZS12aXNpYmlsaXR5LmRlY29yYXRvcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBa0IsTUFBTSxlQUFlLENBQUM7QUFDekQsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFJakYsTUFBTSxTQUFTLEdBQXFCO0lBQ2xDLEVBQUUsT0FBTyxFQUFFLDRCQUE0QixFQUFFLElBQUksRUFBRSxFQUFFLEVBQUU7Q0FDcEQsQ0FBQztBQUNGLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQztBQUMzRCxNQUFNLHFCQUFxQixHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsNEJBQTRCLENBQUMsQ0FBQztBQUV6RSxNQUFNLFVBQVUsc0JBQXNCO0lBQ3BDLE9BQU8sVUFDTCxNQUFXLEVBQ1gsV0FBbUIsRUFDbkIsVUFBOEI7UUFFOUIsTUFBTSxjQUFjLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQztRQUN4QyxJQUFJLHdCQUFzQyxDQUFDO1FBQzNDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFO1lBQ3BCLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ2hDO1FBQ0QsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDO1FBQ3pDLE1BQU0sQ0FBQyxRQUFRLEdBQUcsVUFBUyxHQUFHLElBQUk7WUFDaEMsd0JBQXdCLEdBQUcscUJBQXFCLENBQUMsdUJBQXVCLENBQUMsU0FBUyxDQUNoRixDQUFDLGVBQStDLEVBQUUsRUFBRSxDQUNsRCxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLGVBQWUs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QUN0QztRQUNILENBQUMsQ0FBQztJQUNKLENBQUMsQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFTLHNCQUFzQixDQUFDLE1BQVc7SUFDekMsU0FBUyxDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUMsQ0FBQztBQUNoQyxDQUFDO0FBRUQsU0FBUyx5QkFBeUIsQ0FBQyxNQUFXO0lBQzVDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsYUFBYSxDQUFDLENBQUM7QUFDbkMsQ0FBQztBQUVELFNBQVMsU0FBUyxDQUFDLE1BQVcsRUFBRSxJQUFZO0lBQzFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRTtRQUNsQyxLQUFLLEVBQUUsVUFBUyxHQUFHLElBQUksSUFBRyxDQUFDO1FBQzNCLFFBQVEsRUFBRSxJQUFJO0tBQ2YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdG9yLCBTdGF0aWNQcm92aWRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQW5ndWxhclBhZ2VWaXNpYmlsaXR5U2VydmljZSB9IGZyb20gJy4vYW5ndWxhci1wYWdlLXZpc2liaWxpdHkuc2VydmljZSc7XG5pbXBvcnQgeyBBbmd1bGFyUGFnZVZpc2liaWxpdHlTdGF0ZUVudW0gfSBmcm9tICcuL2FuZ3VsYXItcGFnZS12aXNpYmlsaXR5LnN0YXRlLmVudW0nO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbmNvbnN0IHByb3ZpZGVyczogU3RhdGljUHJvdmlkZXJbXSA9IFtcbiAgeyBwcm92aWRlOiBBbmd1bGFyUGFnZVZpc2liaWxpdHlTZXJ2aWNlLCBkZXBzOiBbXSB9LFxuXTtcbmNvbnN0IGluamVjdG9yID0gSW5qZWN0b3IuY3JlYXRlKHsgcHJvdmlkZXJzOiBwcm92aWRlcnMgfSk7XG5jb25zdCBwYWdlVmlzaWJpbGl0eVNlcnZpY2UgPSBpbmplY3Rvci5nZXQoQW5ndWxhclBhZ2VWaXNpYmlsaXR5U2VydmljZSk7XG5cbmV4cG9ydCBmdW5jdGlvbiBPblBhZ2VWaXNpYmlsaXR5Q2hhbmdlKCk6IE1ldGhvZERlY29yYXRvciB7XG4gIHJldHVybiBmdW5jdGlvbihcbiAgICB0YXJnZXQ6IGFueSxcbiAgICBwcm9wZXJ0eUtleTogc3RyaW5nLFxuICAgIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvcixcbiAgKSB7XG4gICAgY29uc3Qgb3JpZ2luYWxNZXRob2QgPSBkZXNjcmlwdG9yLnZhbHVlO1xuICAgIGxldCBvblBhZ2VIaWRkZW5TdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgICBpZiAoIXRhcmdldC5uZ09uSW5pdCkge1xuICAgICAgYnVpbGROZXdNZXRob2ROZ09uSW5pdCh0YXJnZXQpO1xuICAgIH1cbiAgICBjb25zdCBvcmlnaW5hbE5nT25Jbml0ID0gdGFyZ2V0Lm5nT25Jbml0O1xuICAgIHRhcmdldC5uZ09uSW5pdCA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHtcbiAgICAgIG9uUGFnZUhpZGRlblN1YnNjcmlwdGlvbiA9IHBhZ2VWaXNpYmlsaXR5U2VydmljZS4kb25QYWdlVmlzaWJpbGl0eUNoYW5nZS5zdWJzY3JpYmUoXG4gICAgICAgICh2aXNpYmlsaXR5U3RhdGU6IEFuZ3VsYXJQYWdlVmlzaWJpbGl0eVN0YXRlRW51bSkgPT5cbiAgICAgICAgICBvcmlnaW5hbE1ldGhvZC5jYWxsKHRoaXMsIFt2aXNpYmlsaXR5U3RhdGVdKSxcbiAgICAgICk7XG4gICAgICBpZiAob3JpZ2luYWxOZ09uSW5pdCkge1xuICAgICAgICBvcmlnaW5hbE5nT25Jbml0LmNhbGwodGhpcywgYXJncyk7XG4gICAgICB9XG4gICAgfTtcbiAgICBpZiAoIXRhcmdldC5uZ09uRGVzdHJveSkge1xuICAgICAgYnVpbGROZXdNZXRob2ROZ09uRGVzdHJveSh0YXJnZXQpO1xuICAgIH1cbiAgICBjb25zdCBvcmlnaW5hbE5nT25EZXN0cm95ID0gdGFyZ2V0Lm5nT25EZXN0cm95O1xuICAgIHRhcmdldC5uZ09uRGVzdHJveSA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHtcbiAgICAgIG9uUGFnZUhpZGRlblN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgaWYgKG9yaWdpbmFsTmdPbkRlc3Ryb3kpIHtcbiAgICAgICAgb3JpZ2luYWxOZ09uRGVzdHJveS5jYWxsKHRoaXMsIGFyZ3MpO1xuICAgICAgfVxuICAgIH07XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBPblBhZ2VIaWRkZW4oKTogTWV0aG9kRGVjb3JhdG9yIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKFxuICAgIHRhcmdldDogYW55LFxuICAgIHByb3BlcnR5S2V5OiBzdHJpbmcsXG4gICAgZGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yLFxuICApIHtcbiAgICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XG4gICAgbGV0IG9uUGFnZUhpZGRlblN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICAgIGlmICghdGFyZ2V0Lm5nT25Jbml0KSB7XG4gICAgICBidWlsZE5ld01ldGhvZE5nT25Jbml0KHRhcmdldCk7XG4gICAgfVxuICAgIGNvbnN0IG9yaWdpbmFsTmdPbkluaXQgPSB0YXJnZXQubmdPbkluaXQ7XG4gICAgdGFyZ2V0Lm5nT25Jbml0ID0gZnVuY3Rpb24oLi4uYXJncykge1xuICAgICAgb25QYWdlSGlkZGVuU3Vic2NyaXB0aW9uID0gcGFnZVZpc2liaWxpdHlTZXJ2aWNlLiRvblBhZ2VIaWRkZW4uc3Vic2NyaWJlKFxuICAgICAgICAoKSA9PiBvcmlnaW5hbE1ldGhvZC5jYWxsKHRoaXMpLFxuICAgICAgKTtcbiAgICAgIGlmIChvcmlnaW5hbE5nT25Jbml0KSB7XG4gICAgICAgIG9yaWdpbmFsTmdPbkluaXQuY2FsbCh0aGlzLCBhcmdzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGlmICghdGFyZ2V0Lm5nT25EZXN0cm95KSB7XG4gICAgICBidWlsZE5ld01ldGhvZE5nT25EZXN0cm95KHRhcmdldCk7XG4gICAgfVxuICAgIGNvbnN0IG9yaWdpbmFsTmdPbkRlc3Ryb3kgPSB0YXJnZXQubmdPbkRlc3Ryb3k7XG4gICAgdGFyZ2V0Lm5nT25EZXN0cm95ID0gZnVuY3Rpb24oLi4uYXJncykge1xuICAgICAgb25QYWdlSGlkZGVuU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICBpZiAob3JpZ2luYWxOZ09uRGVzdHJveSkge1xuICAgICAgICBvcmlnaW5hbE5nT25EZXN0cm95LmNhbGwodGhpcywgYXJncyk7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIE9uUGFnZVZpc2libGUoKTogTWV0aG9kRGVjb3JhdG9yIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKFxuICAgIHRhcmdldDogYW55LFxuICAgIHByb3BlcnR5S2V5OiBzdHJpbmcsXG4gICAgZGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yLFxuICApIHtcbiAgICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XG4gICAgaWYgKCF0YXJnZXQubmdPbkluaXQpIHtcbiAgICAgIGJ1aWxkTmV3TWV0aG9kTmdPbkluaXQodGFyZ2V0KTtcbiAgICB9XG4gICAgY29uc3Qgb3JpZ2luYWxOZ09uSW5pdCA9IHRhcmdldC5uZ09uSW5pdDtcbiAgICBsZXQgb25QYWdlVmlzaWJsZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICAgIHRhcmdldC5uZ09uSW5pdCA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHtcbiAgICAgIG9uUGFnZVZpc2libGVTdWJzY3JpcHRpb24gPSBwYWdlVmlzaWJpbGl0eVNlcnZpY2UuJG9uUGFnZVZpc2libGUuc3Vic2NyaWJlKFxuICAgICAgICAoKSA9PiBvcmlnaW5hbE1ldGhvZC5jYWxsKHRoaXMpLFxuICAgICAgKTtcbiAgICAgIGlmIChvcmlnaW5hbE5nT25Jbml0KSB7XG4gICAgICAgIG9yaWdpbmFsTmdPbkluaXQuY2FsbCh0aGlzLCBhcmdzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGlmICghdGFyZ2V0Lm5nT25EZXN0cm95KSB7XG4gICAgICBidWlsZE5ld01ldGhvZE5nT25EZXN0cm95KHRhcmdldCk7XG4gICAgfVxuICAgIGNvbnN0IG9yaWdpbmFsTmdPbkRlc3Ryb3kgPSB0YXJnZXQubmdPbkRlc3Ryb3k7XG4gICAgdGFyZ2V0Lm5nT25EZXN0cm95ID0gZnVuY3Rpb24oLi4uYXJncykge1xuICAgICAgb25QYWdlVmlzaWJsZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgaWYgKG9yaWdpbmFsTmdPbkRlc3Ryb3kpIHtcbiAgICAgICAgb3JpZ2luYWxOZ09uRGVzdHJveS5jYWxsKHRoaXMsIGFyZ3MpO1xuICAgICAgfVxuICAgIH07XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBPblBhZ2VQcmVyZW5kZXIoKTogTWV0aG9kRGVjb3JhdG9yIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKFxuICAgIHRhcmdldDogYW55LFxuICAgIHByb3BlcnR5S2V5OiBzdHJpbmcsXG4gICAgZGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yLFxuICApIHtcbiAgICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XG4gICAgbGV0IG9uUGFnZVByZXJlbmRlclN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICAgIGlmICghdGFyZ2V0Lm5nT25Jbml0KSB7XG4gICAgICBidWlsZE5ld01ldGhvZE5nT25Jbml0KHRhcmdldCk7XG4gICAgfVxuICAgIGNvbnN0IG9yaWdpbmFsTmdPbkluaXQgPSB0YXJnZXQubmdPbkluaXQ7XG4gICAgdGFyZ2V0Lm5nT25Jbml0ID0gZnVuY3Rpb24oLi4uYXJncykge1xuICAgICAgb25QYWdlUHJlcmVuZGVyU3Vic2NyaXB0aW9uID0gcGFnZVZpc2liaWxpdHlTZXJ2aWNlLiRvblBhZ2VQcmVyZW5kZXIuc3Vic2NyaWJlKFxuICAgICAgICAoKSA9PiBvcmlnaW5hbE1ldGhvZC5jYWxsKHRoaXMpLFxuICAgICAgKTtcbiAgICAgIGlmIChvcmlnaW5hbE5nT25Jbml0KSB7XG4gICAgICAgIG9yaWdpbmFsTmdPbkluaXQuY2FsbCh0aGlzLCBhcmdzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGlmICghdGFyZ2V0Lm5nT25EZXN0cm95KSB7XG4gICAgICBidWlsZE5ld01ldGhvZE5nT25EZXN0cm95KHRhcmdldCk7XG4gICAgfVxuICAgIGNvbnN0IG9yaWdpbmFsTmdPbkRlc3Ryb3kgPSB0YXJnZXQubmdPbkRlc3Ryb3k7XG4gICAgdGFyZ2V0Lm5nT25EZXN0cm95ID0gZnVuY3Rpb24oLi4uYXJncykge1xuICAgICAgb25QYWdlUHJlcmVuZGVyU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICBpZiAob3JpZ2luYWxOZ09uRGVzdHJveSkge1xuICAgICAgICBvcmlnaW5hbE5nT25EZXN0cm95LmNhbGwodGhpcywgYXJncyk7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIE9uUGFnZVVubG9hZGVkKCk6IE1ldGhvZERlY29yYXRvciB7XG4gIHJldHVybiBmdW5jdGlvbihcbiAgICB0YXJnZXQ6IGFueSxcbiAgICBwcm9wZXJ0eUtleTogc3RyaW5nLFxuICAgIGRlc2NyaXB0b3I6IFByb3BlcnR5RGVzY3JpcHRvcixcbiAgKSB7XG4gICAgY29uc3Qgb3JpZ2luYWxNZXRob2QgPSBkZXNjcmlwdG9yLnZhbHVlO1xuICAgIGxldCBvblBhZ2VVbmxvYWRlZFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICAgIGlmICghdGFyZ2V0Lm5nT25Jbml0KSB7XG4gICAgICBidWlsZE5ld01ldGhvZE5nT25Jbml0KHRhcmdldCk7XG4gICAgfVxuICAgIGNvbnN0IG9yaWdpbmFsTmdPbkluaXQgPSB0YXJnZXQubmdPbkluaXQ7XG4gICAgdGFyZ2V0Lm5nT25Jbml0ID0gZnVuY3Rpb24oLi4uYXJncykge1xuICAgICAgb25QYWdlVW5sb2FkZWRTdWJzY3JpcHRpb24gPSBwYWdlVmlzaWJpbGl0eVNlcnZpY2UuJG9uUGFnZVVubG9hZGVkLnN1YnNjcmliZShcbiAgICAgICAgKCkgPT4gb3JpZ2luYWxNZXRob2QuY2FsbCh0aGlzKSxcbiAgICAgICk7XG4gICAgICBpZiAob3JpZ2luYWxOZ09uSW5pdCkge1xuICAgICAgICBvcmlnaW5hbE5nT25Jbml0LmNhbGwodGhpcywgYXJncyk7XG4gICAgICB9XG4gICAgfTtcbiAgICBpZiAoIXRhcmdldC5uZ09uRGVzdHJveSkge1xuICAgICAgYnVpbGROZXdNZXRob2ROZ09uRGVzdHJveSh0YXJnZXQpO1xuICAgIH1cbiAgICBjb25zdCBvcmlnaW5hbE5nT25EZXN0cm95ID0gdGFyZ2V0Lm5nT25EZXN0cm95O1xuICAgIHRhcmdldC5uZ09uRGVzdHJveSA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHtcbiAgICAgIG9uUGFnZVVubG9hZGVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICBpZiAob3JpZ2luYWxOZ09uRGVzdHJveSkge1xuICAgICAgICBvcmlnaW5hbE5nT25EZXN0cm95LmNhbGwodGhpcywgYXJncyk7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gYnVpbGROZXdNZXRob2ROZ09uSW5pdCh0YXJnZXQ6IGFueSkge1xuICBuZXdNZXRob2QodGFyZ2V0LCAnbmdPbkluaXQnKTtcbn1cblxuZnVuY3Rpb24gYnVpbGROZXdNZXRob2ROZ09uRGVzdHJveSh0YXJnZXQ6IGFueSkge1xuICBuZXdNZXRob2QodGFyZ2V0LCAnbmdPbkRlc3Ryb3knKTtcbn1cblxuZnVuY3Rpb24gbmV3TWV0aG9kKHRhcmdldDogYW55LCBuYW1lOiBzdHJpbmcpIHtcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgbmFtZSwge1xuICAgIHZhbHVlOiBmdW5jdGlvbiguLi5hcmdzKSB7fSxcbiAgICB3cml0YWJsZTogdHJ1ZSxcbiAgfSk7XG59XG4iXX0=