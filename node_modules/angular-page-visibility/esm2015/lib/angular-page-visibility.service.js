import { __decorate, __metadata } from "tslib";
import { Injectable } from "@angular/core";
import { Subject } from "rxjs";
import { AngularPageVisibilityStateEnum } from "./angular-page-visibility.state.enum";
import * as i0 from "@angular/core";
class HiddenKeyConstant {
}
HiddenKeyConstant.DEFAULT = "hidden";
HiddenKeyConstant.MS = "msHidden";
HiddenKeyConstant.WEB_KIT = "webkitHidden";
class VisibilityStatusConstant {
}
VisibilityStatusConstant.VISIBLE = "visible";
VisibilityStatusConstant.HIDDEN = "hidden";
VisibilityStatusConstant.PRERENDER = "prerender";
VisibilityStatusConstant.UNLOADED = "unloaded";
let AngularPageVisibilityService = class AngularPageVisibilityService {
    constructor() {
        this.onPageVisibleSource = new Subject();
        this.onPageHiddenSource = new Subject();
        this.onPagePrerenderSource = new Subject();
        this.onPageUnloadedSource = new Subject();
        this.onPageVisibilityChangeSource = new Subject();
        this.$onPageVisible = this.onPageVisibleSource.asObservable();
        this.$onPageHidden = this.onPageHiddenSource.asObservable();
        this.$onPagePrerender = this.onPagePrerenderSource.asObservable();
        this.$onPageUnloaded = this.onPageUnloadedSource.asObservable();
        this.$onPageVisibilityChange = this.onPageVisibilityChangeSource.asObservable();
        this.addEventListenerVibilityChange();
    }
    isPageVisible() {
        return (VisibilityStatusConstant.VISIBLE === this.getVisibilityState() ||
            !this.isHidden());
    }
    isPageHidden() {
        return (VisibilityStatusConstant.HIDDEN === this.getVisibilityState() ||
            this.isHidden());
    }
    isPagePrerender() {
        return VisibilityStatusConstant.PRERENDER === this.getVisibilityState();
    }
    isPageUnloaded() {
        return VisibilityStatusConstant.UNLOADED === this.getVisibilityState();
    }
    isHidden() {
        return document[this.hidden];
    }
    getVisibilityState() {
        return document[this.visibilityState];
    }
    defineBrowserSupport() {
        if (typeof document[HiddenKeyConstant.DEFAULT] !== "undefined") {
            // Opera 12.10 and Firefox 18 and later support
            this.hidden = HiddenKeyConstant.DEFAULT;
            this.visibilityChange = "visibilitychange";
            this.visibilityState = "visibilityState";
        }
        else if (typeof document[HiddenKeyConstant.MS] !== "undefined") {
            this.hidden = HiddenKeyConstant.MS;
            this.visibilityChange = "msvisibilitychange";
            this.visibilityState = "msVisibilityState";
        }
        else if (typeof document[HiddenKeyConstant.WEB_KIT] !== "undefined") {
            this.hidden = HiddenKeyConstant.WEB_KIT;
            this.visibilityChange = "webkitvisibilitychange";
            this.visibilityState = "webkitVisibilityState";
        }
    }
    addEventListenerVibilityChange() {
        this.defineBrowserSupport();
        document.addEventListener(this.visibilityChange, () => {
            const vibilityState = this.getVisibilityState();
            switch (vibilityState) {
                case VisibilityStatusConstant.VISIBLE:
                    this.onPageVisibilityChangeSource.next(AngularPageVisibilityStateEnum.VISIBLE);
                    this.onPageVisibleSource.next();
                    break;
                case VisibilityStatusConstant.HIDDEN:
                    this.onPageVisibilityChangeSource.next(AngularPageVisibilityStateEnum.HIDDEN);
                    this.onPageHiddenSource.next();
                    break;
                case VisibilityStatusConstant.PRERENDER:
                    this.onPageVisibilityChangeSource.next(AngularPageVisibilityStateEnum.PRERENDER);
                    this.onPagePrerenderSource.next();
                    break;
                case VisibilityStatusConstant.UNLOADED:
                    this.onPageVisibilityChangeSource.next(AngularPageVisibilityStateEnum.UNLOADED);
                    this.onPageUnloadedSource.next();
                    break;
                default:
                    if (this.isHidden()) {
                        this.onPageVisibilityChangeSource.next(AngularPageVisibilityStateEnum.HIDDEN);
                        this.onPageHiddenSource.next();
                    }
                    else {
                        this.onPageVisibilityChangeSource.next(AngularPageVisibilityStateEnum.VISIBLE);
                        this.onPageVisibleSource.next();
                    }
            }
        }, false);
    }
};
AngularPageVisibilityService.ɵprov = i0.ɵɵdefineInjectable({ factory: function AngularPageVisibilityService_Factory() { return new AngularPageVisibilityService(); }, token: AngularPageVisibilityService, providedIn: "root" });
AngularPageVisibilityService = __decorate([
    Injectable({
        providedIn: "root"
    }),
    __metadata("design:paramtypes", [])
], AngularPageVisibilityService);
export { AngularPageVisibilityService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1wYWdlLXZpc2liaWxpdHkuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItcGFnZS12aXNpYmlsaXR5LyIsInNvdXJjZXMiOlsibGliL2FuZ3VsYXItcGFnZS12aXNpYmlsaXR5LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsOEJBQThCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQzs7QUFFdEYsTUFBTSxpQkFBaUI7O0FBQ2QseUJBQU8sR0FBRyxRQUFRLENBQUM7QUFDbkIsb0JBQUUsR0FBRyxVQUFVLENBQUM7QUFDaEIseUJBQU8sR0FBRyxjQUFjLENBQUM7QUFHbEMsTUFBTSx3QkFBd0I7O0FBQ3JCLGdDQUFPLEdBQUcsU0FBUyxDQUFDO0FBQ3BCLCtCQUFNLEdBQUcsUUFBUSxDQUFDO0FBQ2xCLGtDQUFTLEdBQUcsV0FBVyxDQUFDO0FBQ3hCLGlDQUFRLEdBQUcsVUFBVSxDQUFDO0FBTS9CLElBQWEsNEJBQTRCLEdBQXpDLE1BQWEsNEJBQTRCO0lBc0J2QztRQXJCUSx3QkFBbUIsR0FBa0IsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUN6RCx1QkFBa0IsR0FBa0IsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUN4RCwwQkFBcUIsR0FBa0IsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUMzRCx5QkFBb0IsR0FBa0IsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUMxRCxpQ0FBNEIsR0FFaEMsSUFBSSxPQUFPLEVBQWtDLENBQUM7UUFLbEQsbUJBQWMsR0FBcUIsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFlBQVksRUFBRSxDQUFDO1FBQzNFLGtCQUFhLEdBQXFCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN6RSxxQkFBZ0IsR0FFWixJ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RSxDQUFDO29CQUMvQixNQUFNO2dCQUNSLEtBQUssd0JBQXdCLENBQUMsU0FBUztvQkFDckMsSUFBSSxDQUFDLDRCQUE0QixDQUFDLElBQUksQ0FDcEMsOEJBQThCLENBQUMsU0FBUyxDQUN6QyxDQUFDO29CQUNGLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLEVBQUUsQ0FBQztvQkFDbEMsTUFBTTtnQkFDUixLQUFLLHdCQUF3QixDQUFDLFFBQVE7b0JBQ3BDLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxJQUFJLENBQ3BDLDhCQUE4QixDQUFDLFFBQVEsQ0FDeEMsQ0FBQztvQkFDRixJQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSSxFQUFFLENBQUM7b0JBQ2pDLE1BQU07Z0JBQ1I7b0JBQ0UsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFLEVBQUU7d0JBQ25CLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxJQUFJLENBQ3BDLDhCQUE4QixDQUFDLE1BQU0sQ0FDdEMsQ0FBQzt3QkFDRixJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxFQUFFLENBQUM7cUJBQ2hDO3lCQUFNO3dCQUNMLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxJQUFJLENBQ3BDLDhCQUE4QixDQUFDLE9BQU8sQ0FDdkMsQ0FBQzt3QkFDRixJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxFQUFFLENBQUM7cUJBQ2pDO2FBQ0o7UUFDSCxDQUFDLEVBQ0QsS0FBSyxDQUNOLENBQUM7SUFDSixDQUFDO0NBQ0YsQ0FBQTs7QUF6SFksNEJBQTRCO0lBSHhDLFVBQVUsQ0FBQztRQUNWLFVBQVUsRUFBRSxNQUFNO0tBQ25CLENBQUM7O0dBQ1csNEJBQTRCLENBeUh4QztTQXpIWSw0QkFBNEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgQW5ndWxhclBhZ2VWaXNpYmlsaXR5U3RhdGVFbnVtIH0gZnJvbSBcIi4vYW5ndWxhci1wYWdlLXZpc2liaWxpdHkuc3RhdGUuZW51bVwiO1xuXG5jbGFzcyBIaWRkZW5LZXlDb25zdGFudCB7XG4gIHN0YXRpYyBERUZBVUxUID0gXCJoaWRkZW5cIjtcbiAgc3RhdGljIE1TID0gXCJtc0hpZGRlblwiO1xuICBzdGF0aWMgV0VCX0tJVCA9IFwid2Via2l0SGlkZGVuXCI7XG59XG5cbmNsYXNzIFZpc2liaWxpdHlTdGF0dXNDb25zdGFudCB7XG4gIHN0YXRpYyBWSVNJQkxFID0gXCJ2aXNpYmxlXCI7XG4gIHN0YXRpYyBISURERU4gPSBcImhpZGRlblwiO1xuICBzdGF0aWMgUFJFUkVOREVSID0gXCJwcmVyZW5kZXJcIjtcbiAgc3RhdGljIFVOTE9BREVEID0gXCJ1bmxvYWRlZFwiO1xufVxuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46IFwicm9vdFwiXG59KVxuZXhwb3J0IGNsYXNzIEFuZ3VsYXJQYWdlVmlzaWJpbGl0eVNlcnZpY2Uge1xuICBwcml2YXRlIG9uUGFnZVZpc2libGVTb3VyY2U6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICBwcml2YXRlIG9uUGFnZUhpZGRlblNvdXJjZTogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG4gIHByaXZhdGUgb25QYWdlUHJlcmVuZGVyU291cmNlOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcbiAgcHJpdmF0ZSBvblBhZ2VVbmxvYWRlZFNvdXJjZTogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG4gIHByaXZhdGUgb25QYWdlVmlzaWJpbGl0eUNoYW5nZVNvdXJjZTogU3ViamVjdDxcbiAgICBBbmd1bGFyUGFnZVZpc2liaWxpdHlTdGF0ZUVudW1cbiAgPiA9IG5ldyBTdWJqZWN0PEFuZ3VsYXJQYWdlVmlzaWJpbGl0eVN0YXRlRW51bT4oKTtcbiAgcHJpdmF0ZSBoaWRkZW46IHN0cmluZztcbiAgcHJpdmF0ZSB2aXNpYmlsaXR5Q2hhbmdlOiBzdHJpbmc7XG4gIHByaXZhdGUgdmlzaWJpbGl0eVN0YXRlOiBzdHJpbmc7XG4gIHByaXZhdGUgZG9jdW1lbnQ6IERvY3VtZW50O1xuICAkb25QYWdlVmlzaWJsZTogT2JzZXJ2YWJsZTx2b2lkPiA9IHRoaXMub25QYWdlVmlzaWJsZVNvdXJjZS5hc09ic2VydmFibGUoKTtcbiAgJG9uUGFnZUhpZGRlbjogT2JzZXJ2YWJsZTx2b2lkPiA9IHRoaXMub25QYWdlSGlkZGVuU291cmNlLmFzT2JzZXJ2YWJsZSgpO1xuICAkb25QYWdlUHJlcmVuZGVyOiBPYnNlcnZhYmxlPFxuICAgIHZvaWRcbiAgPiA9IHRoaXMub25QYWdlUHJlcmVuZGVyU291cmNlLmFzT2JzZXJ2YWJsZSgpO1xuICAkb25QYWdlVW5sb2FkZWQ6IE9ic2VydmFibGU8dm9pZD4gPSB0aGlzLm9uUGFnZVVubG9hZGVkU291cmNlLmFzT2JzZXJ2YWJsZSgpO1xuICAkb25QYWdlVmlzaWJpbGl0eUNoYW5nZTogT2JzZXJ2YWJsZTxcbiAgICBBbmd1bGFyUGFnZVZpc2liaWxpdHlTdGF0ZUVudW1cbiAgPiA9IHRoaXMub25QYWdlVmlzaWJpbGl0eUNoYW5nZVNvdXJjZS5hc09ic2VydmFibGUoKTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXJWaWJpbGl0eUNoYW5nZSgpO1xuICB9XG5cbiAgaXNQYWdlVmlzaWJsZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgVmlzaWJpbGl0eVN0YXR1c0NvbnN0YW50LlZJU0lCTEUgPT09IHRoaXMuZ2V0VmlzaWJpbGl0eVN0YXRlKCkgfHxcbiAgICAgICF0aGlzLmlzSGlkZGVuKClcbiAgICApO1xuICB9XG5cbiAgaXNQYWdlSGlkZGVuKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICBWaXNpYmlsaXR5U3RhdHVzQ29uc3RhbnQuSElEREVOID09PSB0aGlzLmdldFZpc2liaWxpdHlTdGF0ZSgpIHx8XG4gICAgICB0aGlzLmlzSGlkZGVuKClcbiAgICApO1xuICB9XG5cbiAgaXNQYWdlUHJlcmVuZGVyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBWaXNpYmlsaXR5U3RhdHVzQ29uc3RhbnQuUFJFUkVOREVSID09PSB0aGlzLmdldFZpc2liaWxpdHlTdGF0ZSgpO1xuICB9XG5cbiAgaXNQYWdlVW5sb2FkZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIFZpc2liaWxpdHlTdGF0dXNDb25zdGFudC5VTkxPQURFRCA9PT0gdGhpcy5nZXRWaXNpYmlsaXR5U3RhdGUoKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNIaWRkZW4oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGRvY3VtZW50W3RoaXMuaGlkZGVuXTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VmlzaWJpbGl0eVN0YXRlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGRvY3VtZW50W3RoaXMudmlzaWJpbGl0eVN0YXRlXTtcbiAgfVxuXG4gIHByaXZhdGUgZGVmaW5lQnJvd3NlclN1cHBvcnQoKSB7XG4gICAgaWYgKHR5cGVvZiBkb2N1bWVudFtIaWRkZW5LZXlDb25zdGFudC5ERUZBVUxUXSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgLy8gT3BlcmEgMTIuMTAgYW5kIEZpcmVmb3ggMTggYW5kIGxhdGVyIHN1cHBvcnRcbiAgICAgIHRoaXMuaGlkZGVuID0gSGlkZGVuS2V5Q29uc3RhbnQuREVGQVVMVDtcbiAgICAgIHRoaXMudmlzaWJpbGl0eUNoYW5nZSA9IFwidmlzaWJpbGl0eWNoYW5nZVwiO1xuICAgICAgdGhpcy52aXNpYmlsaXR5U3RhdGUgPSBcInZpc2liaWxpdHlTdGF0ZVwiO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGRvY3VtZW50W0hpZGRlbktleUNvbnN0YW50Lk1TXSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgdGhpcy5oaWRkZW4gPSBIaWRkZW5LZXlDb25zdGFudC5NUztcbiAgICAgIHRoaXMudmlzaWJpbGl0eUNoYW5nZSA9IFwibXN2aXNpYmlsaXR5Y2hhbmdlXCI7XG4gICAgICB0aGlzLnZpc2liaWxpdHlTdGF0ZSA9IFwibXNWaXNpYmlsaXR5U3RhdGVcIjtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBkb2N1bWVudFtIaWRkZW5LZXlDb25zdGFudC5XRUJfS0lUXSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgdGhpcy5oaWRkZW4gPSBIaWRkZW5LZXlDb25zdGFudC5XRUJfS0lUO1xuICAgICAgdGhpcy52aXNpYmlsaXR5Q2hhbmdlID0gXCJ3ZWJraXR2aXNpYmlsaXR5Y2hhbmdlXCI7XG4gICAgICB0aGlzLnZpc2liaWxpdHlTdGF0ZSA9IFwid2Via2l0VmlzaWJpbGl0eVN0YXRlXCI7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhZGRFdmVudExpc3RlbmVyVmliaWxpdHlDaGFuZ2UoKTogdm9pZCB7XG4gICAgdGhpcy5kZWZpbmVCcm93c2VyU3VwcG9ydCgpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICB0aGlzLnZpc2liaWxpdHlDaGFuZ2UsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHZpYmlsaXR5U3RhdGUgPSB0aGlzLmdldFZpc2liaWxpdHlTdGF0ZSgpO1xuICAgICAgICBzd2l0Y2ggKHZpYmlsaXR5U3RhdGUpIHtcbiAgICAgICAgICBjYXNlIFZpc2liaWxpdHlTdGF0dXNDb25zdGFudC5WSVNJQkxFOlxuICAgICAgICAgICAgdGhpcy5vblBhZ2VWaXNpYmlsaXR5Q2hhbmdlU291cmNlLm5leHQoXG4gICAgICAgICAgICAgIEFuZ3VsYXJQYWdlVmlzaWJpbGl0eVN0YXRlRW51bS5WSVNJQkxFXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy5vblBhZ2VWaXNpYmxlU291cmNlLm5leHQoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgVmlzaWJpbGl0eVN0YXR1c0NvbnN0YW50LkhJRERFTjpcbiAgICAgICAgICAgIHRoaXMub25QYWdlVmlzaWJpbGl0eUNoYW5nZVNvdXJjZS5uZXh0KFxuICAgICAgICAgICAgICBBbmd1bGFyUGFnZVZpc2liaWxpdHlTdGF0ZUVudW0uSElEREVOXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy5vblBhZ2VIaWRkZW5Tb3VyY2UubmV4dCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBWaXNpYmlsaXR5U3RhdHVzQ29uc3RhbnQuUFJFUkVOREVSOlxuICAgICAgICAgICAgdGhpcy5vblBhZ2VWaXNpYmlsaXR5Q2hhbmdlU291cmNlLm5leHQoXG4gICAgICAgICAgICAgIEFuZ3VsYXJQYWdlVmlzaWJpbGl0eVN0YXRlRW51bS5QUkVSRU5ERVJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0aGlzLm9uUGFnZVByZXJlbmRlclNvdXJjZS5uZXh0KCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFZpc2liaWxpdHlTdGF0dXNDb25zdGFudC5VTkxPQURFRDpcbiAgICAgICAgICAgIHRoaXMub25QYWdlVmlzaWJpbGl0eUNoYW5nZVNvdXJjZS5uZXh0KFxuICAgICAgICAgICAgICBBbmd1bGFyUGFnZVZpc2liaWxpdHlTdGF0ZUVudW0uVU5MT0FERURcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0aGlzLm9uUGFnZVVubG9hZGVkU291cmNlLm5leHQoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBpZiAodGhpcy5pc0hpZGRlbigpKSB7XG4gICAgICAgICAgICAgIHRoaXMub25QYWdlVmlzaWJpbGl0eUNoYW5nZVNvdXJjZS5uZXh0KFxuICAgICAgICAgICAgICAgIEFuZ3VsYXJQYWdlVmlzaWJpbGl0eVN0YXRlRW51bS5ISURERU5cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgdGhpcy5vblBhZ2VIaWRkZW5Tb3VyY2UubmV4dCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5vblBhZ2VWaXNpYmlsaXR5Q2hhbmdlU291cmNlLm5leHQoXG4gICAgICAgICAgICAgICAgQW5ndWxhclBhZ2VWaXNpYmlsaXR5U3RhdGVFbnVtLlZJU0lCTEVcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgdGhpcy5vblBhZ2VWaXNpYmxlU291cmNlLm5leHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGZhbHNlXG4gICAgKTtcbiAgfVxufVxuIl19