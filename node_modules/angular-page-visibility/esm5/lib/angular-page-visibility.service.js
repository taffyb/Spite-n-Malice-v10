import { __decorate, __metadata } from "tslib";
import { Injectable } from "@angular/core";
import { Subject } from "rxjs";
import { AngularPageVisibilityStateEnum } from "./angular-page-visibility.state.enum";
import * as i0 from "@angular/core";
var HiddenKeyConstant = /** @class */ (function () {
    function HiddenKeyConstant() {
    }
    HiddenKeyConstant.DEFAULT = "hidden";
    HiddenKeyConstant.MS = "msHidden";
    HiddenKeyConstant.WEB_KIT = "webkitHidden";
    return HiddenKeyConstant;
}());
var VisibilityStatusConstant = /** @class */ (function () {
    function VisibilityStatusConstant() {
    }
    VisibilityStatusConstant.VISIBLE = "visible";
    VisibilityStatusConstant.HIDDEN = "hidden";
    VisibilityStatusConstant.PRERENDER = "prerender";
    VisibilityStatusConstant.UNLOADED = "unloaded";
    return VisibilityStatusConstant;
}());
var AngularPageVisibilityService = /** @class */ (function () {
    function AngularPageVisibilityService() {
        this.onPageVisibleSource = new Subject();
        this.onPageHiddenSource = new Subject();
        this.onPagePrerenderSource = new Subject();
        this.onPageUnloadedSource = new Subject();
        this.onPageVisibilityChangeSource = new Subject();
        this.$onPageVisible = this.onPageVisibleSource.asObservable();
        this.$onPageHidden = this.onPageHiddenSource.asObservable();
        this.$onPagePrerender = this.onPagePrerenderSource.asObservable();
        this.$onPageUnloaded = this.onPageUnloadedSource.asObservable();
        this.$onPageVisibilityChange = this.onPageVisibilityChangeSource.asObservable();
        this.addEventListenerVibilityChange();
    }
    AngularPageVisibilityService.prototype.isPageVisible = function () {
        return (VisibilityStatusConstant.VISIBLE === this.getVisibilityState() ||
            !this.isHidden());
    };
    AngularPageVisibilityService.prototype.isPageHidden = function () {
        return (VisibilityStatusConstant.HIDDEN === this.getVisibilityState() ||
            this.isHidden());
    };
    AngularPageVisibilityService.prototype.isPagePrerender = function () {
        return VisibilityStatusConstant.PRERENDER === this.getVisibilityState();
    };
    AngularPageVisibilityService.prototype.isPageUnloaded = function () {
        return VisibilityStatusConstant.UNLOADED === this.getVisibilityState();
    };
    AngularPageVisibilityService.prototype.isHidden = function () {
        return document[this.hidden];
    };
    AngularPageVisibilityService.prototype.getVisibilityState = function () {
        return document[this.visibilityState];
    };
    AngularPageVisibilityService.prototype.defineBrowserSupport = function () {
        if (typeof document[HiddenKeyConstant.DEFAULT] !== "undefined") {
            // Opera 12.10 and Firefox 18 and later support
            this.hidden = HiddenKeyConstant.DEFAULT;
            this.visibilityChange = "visibilitychange";
            this.visibilityState = "visibilityState";
        }
        else if (typeof document[HiddenKeyConstant.MS] !== "undefined") {
            this.hidden = HiddenKeyConstant.MS;
            this.visibilityChange = "msvisibilitychange";
            this.visibilityState = "msVisibilityState";
        }
        else if (typeof document[HiddenKeyConstant.WEB_KIT] !== "undefined") {
            this.hidden = HiddenKeyConstant.WEB_KIT;
            this.visibilityChange = "webkitvisibilitychange";
            this.visibilityState = "webkitVisibilityState";
        }
    };
    AngularPageVisibilityService.prototype.addEventListenerVibilityChange = function () {
        var _this = this;
        this.defineBrowserSupport();
        document.addEventListener(this.visibilityChange, function () {
            var vibilityState = _this.getVisibilityState();
            switch (vibilityState) {
                case VisibilityStatusConstant.VISIBLE:
                    _this.onPageVisibilityChangeSource.next(AngularPageVisibilityStateEnum.VISIBLE);
                    _this.onPageVisibleSource.next();
                    break;
                case VisibilityStatusConstant.HIDDEN:
                    _this.onPageVisibilityChangeSource.next(AngularPageVisibilityStateEnum.HIDDEN);
                    _this.onPageHiddenSource.next();
                    break;
                case VisibilityStatusConstant.PRERENDER:
                    _this.onPageVisibilityChangeSource.next(AngularPageVisibilityStateEnum.PRERENDER);
                    _this.onPagePrerenderSource.next();
                    break;
                case VisibilityStatusConstant.UNLOADED:
                    _this.onPageVisibilityChangeSource.next(AngularPageVisibilityStateEnum.UNLOADED);
                    _this.onPageUnloadedSource.next();
                    break;
                default:
                    if (_this.isHidden()) {
                        _this.onPageVisibilityChangeSource.next(AngularPageVisibilityStateEnum.HIDDEN);
                        _this.onPageHiddenSource.next();
                    }
                    else {
                        _this.onPageVisibilityChangeSource.next(AngularPageVisibilityStateEnum.VISIBLE);
                        _this.onPageVisibleSource.next();
                    }
            }
        }, false);
    };
    AngularPageVisibilityService.ɵprov = i0.ɵɵdefineInjectable({ factory: function AngularPageVisibilityService_Factory() { return new AngularPageVisibilityService(); }, token: AngularPageVisibilityService, providedIn: "root" });
    AngularPageVisibilityService = __decorate([
        Injectable({
            providedIn: "root"
        }),
        __metadata("design:paramtypes", [])
    ], AngularPageVisibilityService);
    return AngularPageVisibilityService;
}());
export { AngularPageVisibilityService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1wYWdlLXZpc2liaWxpdHkuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItcGFnZS12aXNpYmlsaXR5LyIsInNvdXJjZXMiOlsibGliL2FuZ3VsYXItcGFnZS12aXNpYmlsaXR5LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzQyxPQUFPLEVBQUUsOEJBQThCLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQzs7QUFFdEY7SUFBQTtJQUlBLENBQUM7SUFIUSx5QkFBTyxHQUFHLFFBQVEsQ0FBQztJQUNuQixvQkFBRSxHQUFHLFVBQVUsQ0FBQztJQUNoQix5QkFBTyxHQUFHLGNBQWMsQ0FBQztJQUNsQyx3QkFBQztDQUFBLEFBSkQsSUFJQztBQUVEO0lBQUE7SUFLQSxDQUFDO0lBSlEsZ0NBQU8sR0FBRyxTQUFTLENBQUM7SUFDcEIsK0JBQU0sR0FBRyxRQUFRLENBQUM7SUFDbEIsa0NBQVMsR0FBRyxXQUFXLENBQUM7SUFDeEIsaUNBQVEsR0FBRyxVQUFVLENBQUM7SUFDL0IsK0JBQUM7Q0FBQSxBQUxELElBS0M7QUFLRDtJQXNCRTtRQXJCUSx3QkFBbUIsR0FBa0IsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUN6RCx1QkFBa0IsR0FBa0IsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUN4RCwwQkFBcUIsR0FBa0IsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUMzRCx5QkFBb0IsR0FBa0IsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUMxRCxpQ0FBNEIsR0FFaEMsSUFBSSxPQUFPLEVBQWtDLENBQUM7UUFLbEQsbUJBQWMsR0FBcUIsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFlBQVksRUFBRSxDQUFDO1FBQzNFLGtCQUFhLEdBQXFCLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLEVBQUUs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b3JlXCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSBcInJ4anNcIjtcbmltcG9ydCB7IEFuZ3VsYXJQYWdlVmlzaWJpbGl0eVN0YXRlRW51bSB9IGZyb20gXCIuL2FuZ3VsYXItcGFnZS12aXNpYmlsaXR5LnN0YXRlLmVudW1cIjtcblxuY2xhc3MgSGlkZGVuS2V5Q29uc3RhbnQge1xuICBzdGF0aWMgREVGQVVMVCA9IFwiaGlkZGVuXCI7XG4gIHN0YXRpYyBNUyA9IFwibXNIaWRkZW5cIjtcbiAgc3RhdGljIFdFQl9LSVQgPSBcIndlYmtpdEhpZGRlblwiO1xufVxuXG5jbGFzcyBWaXNpYmlsaXR5U3RhdHVzQ29uc3RhbnQge1xuICBzdGF0aWMgVklTSUJMRSA9IFwidmlzaWJsZVwiO1xuICBzdGF0aWMgSElEREVOID0gXCJoaWRkZW5cIjtcbiAgc3RhdGljIFBSRVJFTkRFUiA9IFwicHJlcmVuZGVyXCI7XG4gIHN0YXRpYyBVTkxPQURFRCA9IFwidW5sb2FkZWRcIjtcbn1cblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiBcInJvb3RcIlxufSlcbmV4cG9ydCBjbGFzcyBBbmd1bGFyUGFnZVZpc2liaWxpdHlTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBvblBhZ2VWaXNpYmxlU291cmNlOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcbiAgcHJpdmF0ZSBvblBhZ2VIaWRkZW5Tb3VyY2U6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICBwcml2YXRlIG9uUGFnZVByZXJlbmRlclNvdXJjZTogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG4gIHByaXZhdGUgb25QYWdlVW5sb2FkZWRTb3VyY2U6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICBwcml2YXRlIG9uUGFnZVZpc2liaWxpdHlDaGFuZ2VTb3VyY2U6IFN1YmplY3Q8XG4gICAgQW5ndWxhclBhZ2VWaXNpYmlsaXR5U3RhdGVFbnVtXG4gID4gPSBuZXcgU3ViamVjdDxBbmd1bGFyUGFnZVZpc2liaWxpdHlTdGF0ZUVudW0+KCk7XG4gIHByaXZhdGUgaGlkZGVuOiBzdHJpbmc7XG4gIHByaXZhdGUgdmlzaWJpbGl0eUNoYW5nZTogc3RyaW5nO1xuICBwcml2YXRlIHZpc2liaWxpdHlTdGF0ZTogc3RyaW5nO1xuICBwcml2YXRlIGRvY3VtZW50OiBEb2N1bWVudDtcbiAgJG9uUGFnZVZpc2libGU6IE9ic2VydmFibGU8dm9pZD4gPSB0aGlzLm9uUGFnZVZpc2libGVTb3VyY2UuYXNPYnNlcnZhYmxlKCk7XG4gICRvblBhZ2VIaWRkZW46IE9ic2VydmFibGU8dm9pZD4gPSB0aGlzLm9uUGFnZUhpZGRlblNvdXJjZS5hc09ic2VydmFibGUoKTtcbiAgJG9uUGFnZVByZXJlbmRlcjogT2JzZXJ2YWJsZTxcbiAgICB2b2lkXG4gID4gPSB0aGlzLm9uUGFnZVByZXJlbmRlclNvdXJjZS5hc09ic2VydmFibGUoKTtcbiAgJG9uUGFnZVVubG9hZGVkOiBPYnNlcnZhYmxlPHZvaWQ+ID0gdGhpcy5vblBhZ2VVbmxvYWRlZFNvdXJjZS5hc09ic2VydmFibGUoKTtcbiAgJG9uUGFnZVZpc2liaWxpdHlDaGFuZ2U6IE9ic2VydmFibGU8XG4gICAgQW5ndWxhclBhZ2VWaXNpYmlsaXR5U3RhdGVFbnVtXG4gID4gPSB0aGlzLm9uUGFnZVZpc2liaWxpdHlDaGFuZ2VTb3VyY2UuYXNPYnNlcnZhYmxlKCk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5hZGRFdmVudExpc3RlbmVyVmliaWxpdHlDaGFuZ2UoKTtcbiAgfVxuXG4gIGlzUGFnZVZpc2libGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgIFZpc2liaWxpdHlTdGF0dXNDb25zdGFudC5WSVNJQkxFID09PSB0aGlzLmdldFZpc2liaWxpdHlTdGF0ZSgpIHx8XG4gICAgICAhdGhpcy5pc0hpZGRlbigpXG4gICAgKTtcbiAgfVxuXG4gIGlzUGFnZUhpZGRlbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKFxuICAgICAgVmlzaWJpbGl0eVN0YXR1c0NvbnN0YW50LkhJRERFTiA9PT0gdGhpcy5nZXRWaXNpYmlsaXR5U3RhdGUoKSB8fFxuICAgICAgdGhpcy5pc0hpZGRlbigpXG4gICAgKTtcbiAgfVxuXG4gIGlzUGFnZVByZXJlbmRlcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gVmlzaWJpbGl0eVN0YXR1c0NvbnN0YW50LlBSRVJFTkRFUiA9PT0gdGhpcy5nZXRWaXNpYmlsaXR5U3RhdGUoKTtcbiAgfVxuXG4gIGlzUGFnZVVubG9hZGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBWaXNpYmlsaXR5U3RhdHVzQ29uc3RhbnQuVU5MT0FERUQgPT09IHRoaXMuZ2V0VmlzaWJpbGl0eVN0YXRlKCk7XG4gIH1cblxuICBwcml2YXRlIGlzSGlkZGVuKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBkb2N1bWVudFt0aGlzLmhpZGRlbl07XG4gIH1cblxuICBwcml2YXRlIGdldFZpc2liaWxpdHlTdGF0ZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBkb2N1bWVudFt0aGlzLnZpc2liaWxpdHlTdGF0ZV07XG4gIH1cblxuICBwcml2YXRlIGRlZmluZUJyb3dzZXJTdXBwb3J0KCkge1xuICAgIGlmICh0eXBlb2YgZG9jdW1lbnRbSGlkZGVuS2V5Q29uc3RhbnQuREVGQVVMVF0gIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIC8vIE9wZXJhIDEyLjEwIGFuZCBGaXJlZm94IDE4IGFuZCBsYXRlciBzdXBwb3J0XG4gICAgICB0aGlzLmhpZGRlbiA9IEhpZGRlbktleUNvbnN0YW50LkRFRkFVTFQ7XG4gICAgICB0aGlzLnZpc2liaWxpdHlDaGFuZ2UgPSBcInZpc2liaWxpdHljaGFuZ2VcIjtcbiAgICAgIHRoaXMudmlzaWJpbGl0eVN0YXRlID0gXCJ2aXNpYmlsaXR5U3RhdGVcIjtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBkb2N1bWVudFtIaWRkZW5LZXlDb25zdGFudC5NU10gIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIHRoaXMuaGlkZGVuID0gSGlkZGVuS2V5Q29uc3RhbnQuTVM7XG4gICAgICB0aGlzLnZpc2liaWxpdHlDaGFuZ2UgPSBcIm1zdmlzaWJpbGl0eWNoYW5nZVwiO1xuICAgICAgdGhpcy52aXNpYmlsaXR5U3RhdGUgPSBcIm1zVmlzaWJpbGl0eVN0YXRlXCI7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZG9jdW1lbnRbSGlkZGVuS2V5Q29uc3RhbnQuV0VCX0tJVF0gIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIHRoaXMuaGlkZGVuID0gSGlkZGVuS2V5Q29uc3RhbnQuV0VCX0tJVDtcbiAgICAgIHRoaXMudmlzaWJpbGl0eUNoYW5nZSA9IFwid2Via2l0dmlzaWJpbGl0eWNoYW5nZVwiO1xuICAgICAgdGhpcy52aXNpYmlsaXR5U3RhdGUgPSBcIndlYmtpdFZpc2liaWxpdHlTdGF0ZVwiO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWRkRXZlbnRMaXN0ZW5lclZpYmlsaXR5Q2hhbmdlKCk6IHZvaWQge1xuICAgIHRoaXMuZGVmaW5lQnJvd3NlclN1cHBvcnQoKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgdGhpcy52aXNpYmlsaXR5Q2hhbmdlLFxuICAgICAgKCkgPT4ge1xuICAgICAgICBjb25zdCB2aWJpbGl0eVN0YXRlID0gdGhpcy5nZXRWaXNpYmlsaXR5U3RhdGUoKTtcbiAgICAgICAgc3dpdGNoICh2aWJpbGl0eVN0YXRlKSB7XG4gICAgICAgICAgY2FzZSBWaXNpYmlsaXR5U3RhdHVzQ29uc3RhbnQuVklTSUJMRTpcbiAgICAgICAgICAgIHRoaXMub25QYWdlVmlzaWJpbGl0eUNoYW5nZVNvdXJjZS5uZXh0KFxuICAgICAgICAgICAgICBBbmd1bGFyUGFnZVZpc2liaWxpdHlTdGF0ZUVudW0uVklTSUJMRVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMub25QYWdlVmlzaWJsZVNvdXJjZS5uZXh0KCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFZpc2liaWxpdHlTdGF0dXNDb25zdGFudC5ISURERU46XG4gICAgICAgICAgICB0aGlzLm9uUGFnZVZpc2liaWxpdHlDaGFuZ2VTb3VyY2UubmV4dChcbiAgICAgICAgICAgICAgQW5ndWxhclBhZ2VWaXNpYmlsaXR5U3RhdGVFbnVtLkhJRERFTlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMub25QYWdlSGlkZGVuU291cmNlLm5leHQoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgVmlzaWJpbGl0eVN0YXR1c0NvbnN0YW50LlBSRVJFTkRFUjpcbiAgICAgICAgICAgIHRoaXMub25QYWdlVmlzaWJpbGl0eUNoYW5nZVNvdXJjZS5uZXh0KFxuICAgICAgICAgICAgICBBbmd1bGFyUGFnZVZpc2liaWxpdHlTdGF0ZUVudW0uUFJFUkVOREVSXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy5vblBhZ2VQcmVyZW5kZXJTb3VyY2UubmV4dCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBWaXNpYmlsaXR5U3RhdHVzQ29uc3RhbnQuVU5MT0FERUQ6XG4gICAgICAgICAgICB0aGlzLm9uUGFnZVZpc2liaWxpdHlDaGFuZ2VTb3VyY2UubmV4dChcbiAgICAgICAgICAgICAgQW5ndWxhclBhZ2VWaXNpYmlsaXR5U3RhdGVFbnVtLlVOTE9BREVEXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy5vblBhZ2VVbmxvYWRlZFNvdXJjZS5uZXh0KCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgaWYgKHRoaXMuaXNIaWRkZW4oKSkge1xuICAgICAgICAgICAgICB0aGlzLm9uUGFnZVZpc2liaWxpdHlDaGFuZ2VTb3VyY2UubmV4dChcbiAgICAgICAgICAgICAgICBBbmd1bGFyUGFnZVZpc2liaWxpdHlTdGF0ZUVudW0uSElEREVOXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHRoaXMub25QYWdlSGlkZGVuU291cmNlLm5leHQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMub25QYWdlVmlzaWJpbGl0eUNoYW5nZVNvdXJjZS5uZXh0KFxuICAgICAgICAgICAgICAgIEFuZ3VsYXJQYWdlVmlzaWJpbGl0eVN0YXRlRW51bS5WSVNJQkxFXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHRoaXMub25QYWdlVmlzaWJsZVNvdXJjZS5uZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBmYWxzZVxuICAgICk7XG4gIH1cbn1cbiJdfQ==